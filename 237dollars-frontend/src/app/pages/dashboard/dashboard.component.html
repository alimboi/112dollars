<div class="dashboard-container">
  <div class="container py-5">
    <!-- Loading State -->
    <div *ngIf="loading" class="loading">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">{{ 'common.loading' | translate }}</span>
      </div>
    </div>

    <!-- Main Content -->
    <div *ngIf="!loading">
      <!-- Welcome Section -->
      <div class="welcome-section mb-5">
        <h1 class="welcome-title">
          {{ getGreeting() | translate }}, <span class="accent">{{ userName }}</span>!
        </h1>
        <p class="welcome-subtitle">{{ 'dashboard.subtitle' | translate }}</p>
      </div>

      <!-- Stats Cards -->
      <div class="row g-4 mb-5">
        <!-- Points Card -->
        <div class="col-md-6 col-lg-3">
          <div class="stat-card">
            <div class="stat-icon points">
              <i class="bi bi-trophy-fill"></i>
            </div>
            <h3>{{ stats.points.total }}</h3>
            <p>{{ 'dashboard.totalPoints' | translate }}</p>
            <div class="stat-details">
              <small>
                <i class="bi bi-book"></i> {{ stats.points.reading }} {{ 'dashboard.reading' | translate }} |
                <i class="bi bi-question-circle"></i> {{ stats.points.quiz }} {{ 'dashboard.quiz' | translate }}
              </small>
            </div>
            <a routerLink="/points" class="stat-link">{{ 'dashboard.viewDetails' | translate }} →</a>
          </div>
        </div>

        <!-- Enrollments Card -->
        <div class="col-md-6 col-lg-3">
          <div class="stat-card">
            <div class="stat-icon enrollments">
              <i class="bi bi-journal-check"></i>
            </div>
            <h3>{{ stats.enrollments.total }}</h3>
            <p>{{ 'dashboard.enrollments' | translate }}</p>
            <div class="stat-details">
              <small>
                <i class="bi bi-clock"></i> {{ stats.enrollments.pending }} {{ 'dashboard.pending' | translate }} |
                <i class="bi bi-check-circle"></i> {{ stats.enrollments.approved }} {{ 'dashboard.approved' | translate }}
              </small>
            </div>
            <a routerLink="/enrollment" class="stat-link">{{ 'dashboard.viewDetails' | translate }} →</a>
          </div>
        </div>

        <!-- Documents Card -->
        <div class="col-md-6 col-lg-3">
          <div class="stat-card">
            <div class="stat-icon documents">
              <i class="bi bi-file-earmark-text-fill"></i>
            </div>
            <h3>{{ stats.documents.total }}</h3>
            <p>{{ 'dashboard.documents' | translate }}</p>
            <div class="stat-details">
              <small>{{ 'dashboard.uploadedFiles' | translate }}</small>
            </div>
            <a routerLink="/documents" class="stat-link">{{ 'dashboard.viewDetails' | translate }} →</a>
          </div>
        </div>

        <!-- Discounts Card -->
        <div class="col-md-6 col-lg-3">
          <div class="stat-card">
            <div class="stat-icon discounts">
              <i class="bi bi-ticket-perforated-fill"></i>
            </div>
            <h3>{{ stats.discounts.available }}</h3>
            <p>{{ 'dashboard.availableDiscounts' | translate }}</p>
            <div class="stat-details" *ngIf="stats.discounts.recentCode">
              <small class="discount-code-preview">{{ stats.discounts.recentCode }}</small>
            </div>
            <a routerLink="/discounts" class="stat-link">{{ 'dashboard.viewDetails' | translate }} →</a>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="row g-4 mb-5">
        <div class="col-12">
          <div class="section-card">
            <h2 class="section-title">
              <i class="bi bi-lightning-charge-fill"></i>
              {{ 'dashboard.quickActions' | translate }}
            </h2>
            <div class="row g-3">
              <div class="col-md-6 col-lg-3">
                <a routerLink="/references" class="action-card">
                  <div class="action-icon">
                    <i class="bi bi-book-fill"></i>
                  </div>
                  <h4>{{ 'dashboard.browseReferences' | translate }}</h4>
                  <p>{{ 'dashboard.browseReferencesDesc' | translate }}</p>
                </a>
              </div>

              <div class="col-md-6 col-lg-3">
                <a routerLink="/points" class="action-card">
                  <div class="action-icon">
                    <i class="bi bi-graph-up-arrow"></i>
                  </div>
                  <h4>{{ 'dashboard.viewLeaderboard' | translate }}</h4>
                  <p>{{ 'dashboard.viewLeaderboardDesc' | translate }}</p>
                </a>
              </div>

              <div class="col-md-6 col-lg-3">
                <a routerLink="/discounts" class="action-card">
                  <div class="action-icon">
                    <i class="bi bi-gift-fill"></i>
                  </div>
                  <h4>{{ 'dashboard.applyDiscount' | translate }}</h4>
                  <p>{{ 'dashboard.applyDiscountDesc' | translate }}</p>
                </a>
              </div>

              <div class="col-md-6 col-lg-3">
                <a routerLink="/documents" class="action-card">
                  <div class="action-icon">
                    <i class="bi bi-cloud-upload-fill"></i>
                  </div>
                  <h4>{{ 'dashboard.uploadDocument' | translate }}</h4>
                  <p>{{ 'dashboard.uploadDocumentDesc' | translate }}</p>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Activity & Progress -->
      <div class="row g-4">
        <!-- Recent Documents -->
        <div class="col-lg-6">
          <div class="section-card">
            <h2 class="section-title">
              <i class="bi bi-clock-history"></i>
              {{ 'dashboard.recentDocuments' | translate }}
            </h2>
            <div *ngIf="stats.documents.recent.length === 0" class="empty-state">
              <i class="bi bi-file-earmark-x"></i>
              <p>{{ 'dashboard.noRecentDocuments' | translate }}</p>
              <a routerLink="/documents" class="btn btn-primary btn-sm">{{ 'dashboard.uploadFirst' | translate }}</a>
            </div>
            <div *ngIf="stats.documents.recent.length > 0" class="list-group">
              <div *ngFor="let doc of stats.documents.recent" class="list-group-item">
                <div class="d-flex align-items-center">
                  <i class="bi bi-file-earmark-pdf text-danger me-3" style="font-size: 1.5rem;"></i>
                  <div class="flex-grow-1">
                    <h6 class="mb-0">{{ doc.fileName }}</h6>
                    <small class="text-muted">{{ doc.uploadedAt | date:'short' }}</small>
                  </div>
                </div>
              </div>
            </div>
            <div *ngIf="stats.documents.total > 3" class="mt-3 text-center">
              <a routerLink="/documents" class="btn btn-outline-primary btn-sm">
                {{ 'dashboard.viewAllDocuments' | translate }}
              </a>
            </div>
          </div>
        </div>

        <!-- Points Progress -->
        <div class="col-lg-6">
          <div class="section-card">
            <h2 class="section-title">
              <i class="bi bi-bar-chart-fill"></i>
              {{ 'dashboard.pointsProgress' | translate }}
            </h2>
            <div class="progress-section">
              <div class="progress-item mb-4">
                <div class="d-flex justify-content-between mb-2">
                  <span>{{ 'dashboard.nextDiscount' | translate }} (500 {{ 'points.totalPoints' | translate }})</span>
                  <span class="fw-bold text-primary">{{ stats.points.total }}/500</span>
                </div>
                <div class="progress" style="height: 12px;">
                  <div class="progress-bar bg-primary" role="progressbar"
                       [style.width.%]="getProgressPercentage(stats.points.total, 500)"
                       [attr.aria-valuenow]="stats.points.total"
                       aria-valuemin="0" aria-valuemax="500">
                  </div>
                </div>
              </div>

              <div class="points-breakdown">
                <div class="breakdown-item">
                  <div class="breakdown-icon reading">
                    <i class="bi bi-book"></i>
                  </div>
                  <div class="breakdown-content">
                    <h5>{{ stats.points.reading }}</h5>
                    <p>{{ 'dashboard.readingPoints' | translate }}</p>
                  </div>
                </div>
                <div class="breakdown-item">
                  <div class="breakdown-icon quiz">
                    <i class="bi bi-question-circle"></i>
                  </div>
                  <div class="breakdown-content">
                    <h5>{{ stats.points.quiz }}</h5>
                    <p>{{ 'dashboard.quizPoints' | translate }}</p>
                  </div>
                </div>
              </div>

              <div class="mt-4 text-center">
                <a routerLink="/references" class="btn btn-primary">
                  <i class="bi bi-plus-circle me-2"></i>{{ 'dashboard.earnMorePoints' | translate }}
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
