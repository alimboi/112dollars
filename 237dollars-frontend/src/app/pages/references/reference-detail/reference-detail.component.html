<div class="reference-page">
  <div class="reference-container">
    <!-- Loading State -->
    <div class="loading-state" *ngIf="loading">
      <div class="spinner-large"></div>
      <p class="loading-text">Loading content...</p>
    </div>

    <!-- Error State -->
    <div class="alert alert-error" *ngIf="error && !loading">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
      <span>{{ error }}</span>
    </div>

    <!-- Reference Content -->
    <div *ngIf="!loading && !error && reference" class="reference-content">
      <!-- Back Button -->
      <button routerLink="/references" class="btn-back">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
        <span>Back to References</span>
      </button>

      <!-- Reference Header -->
      <div class="reference-header">
        <h1 class="reference-title">{{ reference.title }}</h1>
        <p class="reference-description">{{ reference.description }}</p>

        <div class="reference-meta">
          <div class="meta-badge reading-time">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            <span>{{ reference.readingTimeMinutes }} min read</span>
          </div>

          <div class="meta-badge" [ngClass]="reference.isFree ? 'badge-free' : 'badge-premium'">
            <svg *ngIf="reference.isFree" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
              <path d="M7 11V7a5 5 0 0 1 9.9-1"></path>
            </svg>
            <svg *ngIf="!reference.isFree" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
            </svg>
            <span>{{ reference.isFree ? 'Free' : 'Premium' }}</span>
          </div>
        </div>
      </div>

      <!-- Reference Body -->
      <div class="reference-body">
        <div class="content-block" *ngFor="let block of reference.contentBlocks" [ngSwitch]="block.blockType">
          <!-- Heading Block -->
          <h2 *ngSwitchCase="'heading'" class="heading-block" [ngStyle]="getThemeAwareStyle({
            'font-family': block.styling?.fontFamily,
            'font-size.px': block.styling?.fontSize,
            'color': block.styling?.color,
            'background-color': block.styling?.backgroundColor,
            'font-weight': block.styling?.fontWeight,
            'text-align': block.styling?.textAlign,
            'line-height': block.styling?.lineHeight,
            'margin-top.px': block.styling?.marginTop,
            'margin-bottom.px': block.styling?.marginBottom,
            'padding.px': block.styling?.padding
          })">{{ block.content }}</h2>

          <!-- Text Block -->
          <p *ngSwitchCase="'text'" class="text-block" [ngStyle]="getThemeAwareStyle({
            'font-family': block.styling?.fontFamily,
            'font-size.px': block.styling?.fontSize,
            'color': block.styling?.color,
            'background-color': block.styling?.backgroundColor,
            'font-weight': block.styling?.fontWeight,
            'text-align': block.styling?.textAlign,
            'line-height': block.styling?.lineHeight,
            'letter-spacing.px': block.styling?.letterSpacing,
            'margin-top.px': block.styling?.marginTop,
            'margin-bottom.px': block.styling?.marginBottom,
            'padding.px': block.styling?.padding
          })">{{ block.content }}</p>

          <!-- Image Block -->
          <div *ngSwitchCase="'image'" class="image-block" [ngStyle]="{'text-align': block.blockData?.alignment}">
            <div class="image-wrapper">
              <img [src]="block.blockData?.url"
                   [alt]="block.blockData?.alt || 'Content image'"
                   [ngStyle]="{
                     'width': block.blockData?.width,
                     'height': block.blockData?.height,
                     'border-radius.px': block.blockData?.borderRadius
                   }"
                   [class]="'shadow-' + block.blockData?.boxShadow">
            </div>
          </div>

          <!-- Video Block (YouTube Embed) -->
          <div *ngSwitchCase="'video'" class="video-block" [ngStyle]="{'text-align': block.blockData?.alignment}">
            <div class="video-wrapper">
              <iframe *ngIf="block.blockData?.videoId"
                      [src]="'https://www.youtube.com/embed/' + block.blockData?.videoId | safeUrl"
                      [style.width]="block.blockData?.width"
                      height="400"
                      frameborder="0"
                      allowfullscreen>
              </iframe>
            </div>
          </div>

          <!-- Code Block -->
          <div *ngSwitchCase="'code_block'" class="code-block" [ngStyle]="getThemeAwareStyle({
            'background-color': block.styling?.backgroundColor,
            'color': block.styling?.color,
            'padding.px': block.styling?.padding,
            'margin-top.px': block.styling?.marginTop,
            'margin-bottom.px': block.styling?.marginBottom
          })">
            <div class="code-header">
              <div class="code-dots">
                <span class="dot dot-red"></span>
                <span class="dot dot-yellow"></span>
                <span class="dot dot-green"></span>
              </div>
              <span class="code-label">Code</span>
            </div>
            <pre><code>{{ block.content }}</code></pre>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
