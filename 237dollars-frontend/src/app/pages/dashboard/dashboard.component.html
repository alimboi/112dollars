<div class="dashboard-page">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>Loading your dashboard...</p>
    </div>
  </div>

  <!-- Main Dashboard Content -->
  <div *ngIf="!loading" class="dashboard-container">
    <!-- Welcome Header -->
    <div class="dashboard-header">
      <div class="header-content">
        <div class="header-text">
          <h1 class="dashboard-title">
            {{ getGreeting() | translate }}, <span class="gradient-text">{{ userName }}</span>!
          </h1>
          <p class="dashboard-subtitle">{{ 'dashboard.subtitle' | translate }}</p>
        </div>
        <div class="header-icon">
          <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
          </svg>
        </div>
      </div>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
      <!-- Points Card -->
      <div class="stat-card points-card">
        <div class="stat-card-icon">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
            <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
            <path d="M4 22h16"></path>
            <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path>
            <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path>
            <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
          </svg>
        </div>
        <div class="stat-card-content">
          <h3 class="stat-number">{{ stats.points.total }}</h3>
          <p class="stat-label">{{ 'dashboard.totalPoints' | translate }}</p>
          <div class="stat-breakdown">
            <span><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg> {{ stats.points.reading }} Reading</span>
            <span><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg> {{ stats.points.quiz }} Quiz</span>
          </div>
        </div>
        <a routerLink="/points" class="stat-link">
          <span>View Details</span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
        </a>
      </div>

      <!-- Enrollments Card -->
      <div class="stat-card enrollments-card">
        <div class="stat-card-icon">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
          </svg>
        </div>
        <div class="stat-card-content">
          <h3 class="stat-number">{{ stats.enrollments.total }}</h3>
          <p class="stat-label">{{ 'dashboard.enrollments' | translate }}</p>
          <div class="stat-breakdown">
            <span><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> {{ stats.enrollments.pending }} Pending</span>
            <span><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg> {{ stats.enrollments.approved }} Approved</span>
          </div>
        </div>
        <a routerLink="/enrollment" class="stat-link">
          <span>View Details</span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
        </a>
      </div>

      <!-- Documents Card -->
      <div class="stat-card documents-card">
        <div class="stat-card-icon">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="16" y1="13" x2="8" y2="13"></line>
            <line x1="16" y1="17" x2="8" y2="17"></line>
            <polyline points="10 9 9 9 8 9"></polyline>
          </svg>
        </div>
        <div class="stat-card-content">
          <h3 class="stat-number">{{ stats.documents.total }}</h3>
          <p class="stat-label">{{ 'dashboard.documents' | translate }}</p>
          <div class="stat-breakdown">
            <span>{{ 'dashboard.uploadedFiles' | translate }}</span>
          </div>
        </div>
        <a routerLink="/documents" class="stat-link">
          <span>View Details</span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
        </a>
      </div>

      <!-- Discounts Card -->
      <div class="stat-card discounts-card">
        <div class="stat-card-icon">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="9" cy="9" r="2"></circle>
            <circle cx="15" cy="15" r="2"></circle>
            <path d="M19.5 4.5 4.5 19.5"></path>
            <path d="M21.5 2.5 2.5 21.5"></path>
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          </svg>
        </div>
        <div class="stat-card-content">
          <h3 class="stat-number">{{ stats.discounts.available }}</h3>
          <p class="stat-label">{{ 'dashboard.availableDiscounts' | translate }}</p>
          <div class="stat-breakdown" *ngIf="stats.discounts.recentCode">
            <span class="discount-code">{{ stats.discounts.recentCode }}</span>
          </div>
        </div>
        <a routerLink="/discounts" class="stat-link">
          <span>View Details</span>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="5" y1="12" x2="19" y2="12"></line>
            <polyline points="12 5 19 12 12 19"></polyline>
          </svg>
        </a>
      </div>
    </div>

    <!-- Quick Actions Section -->
    <div class="section-card quick-actions-section">
      <div class="section-header">
        <div class="section-header-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
          </svg>
        </div>
        <h2 class="section-title">{{ 'dashboard.quickActions' | translate }}</h2>
      </div>
      <div class="quick-actions-grid">
        <a routerLink="/references" class="action-card">
          <div class="action-card-icon primary">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
              <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
            </svg>
          </div>
          <h4>{{ 'dashboard.browseReferences' | translate }}</h4>
          <p>{{ 'dashboard.browseReferencesDesc' | translate }}</p>
        </a>

        <a routerLink="/points" class="action-card">
          <div class="action-card-icon secondary">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="20" x2="12" y2="10"></line>
              <line x1="18" y1="20" x2="18" y2="4"></line>
              <line x1="6" y1="20" x2="6" y2="16"></line>
            </svg>
          </div>
          <h4>{{ 'dashboard.viewLeaderboard' | translate }}</h4>
          <p>{{ 'dashboard.viewLeaderboardDesc' | translate }}</p>
        </a>

        <a routerLink="/discounts" class="action-card">
          <div class="action-card-icon accent">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 12 20 22 4 22 4 12"></polyline>
              <rect x="2" y="7" width="20" height="5"></rect>
              <line x1="12" y1="22" x2="12" y2="7"></line>
              <path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"></path>
              <path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"></path>
            </svg>
          </div>
          <h4>{{ 'dashboard.applyDiscount' | translate }}</h4>
          <p>{{ 'dashboard.applyDiscountDesc' | translate }}</p>
        </a>

        <a routerLink="/documents" class="action-card">
          <div class="action-card-icon primary">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="17 8 12 3 7 8"></polyline>
              <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
          </div>
          <h4>{{ 'dashboard.uploadDocument' | translate }}</h4>
          <p>{{ 'dashboard.uploadDocumentDesc' | translate }}</p>
        </a>
      </div>
    </div>

    <!-- Two Column Section: Recent Activity & Progress -->
    <div class="two-column-section">
      <!-- Recent Documents -->
      <div class="section-card recent-documents-section">
        <div class="section-header">
          <div class="section-header-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
          </div>
          <h2 class="section-title">{{ 'dashboard.recentDocuments' | translate }}</h2>
        </div>

        <!-- Empty State -->
        <div *ngIf="stats.documents.recent.length === 0" class="empty-state">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
          </svg>
          <p>{{ 'dashboard.noRecentDocuments' | translate }}</p>
          <a routerLink="/documents" class="btn-modern btn-primary btn-sm">{{ 'dashboard.uploadFirst' | translate }}</a>
        </div>

        <!-- Documents List -->
        <div *ngIf="stats.documents.recent.length > 0" class="documents-list">
          <div *ngFor="let doc of stats.documents.recent" class="document-item">
            <div class="document-icon">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                <polyline points="14 2 14 8 20 8"></polyline>
              </svg>
            </div>
            <div class="document-info">
              <h6>{{ doc.fileName }}</h6>
              <span class="document-date">{{ doc.uploadedAt | date:'short' }}</span>
            </div>
          </div>
        </div>

        <div *ngIf="stats.documents.total > 3" class="section-footer">
          <a routerLink="/documents" class="btn-modern btn-outline-primary btn-sm">{{ 'dashboard.viewAllDocuments' | translate }}</a>
        </div>
      </div>

      <!-- Points Progress -->
      <div class="section-card points-progress-section">
        <div class="section-header">
          <div class="section-header-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="20" x2="12" y2="10"></line>
              <line x1="18" y1="20" x2="18" y2="4"></line>
              <line x1="6" y1="20" x2="6" y2="16"></line>
            </svg>
          </div>
          <h2 class="section-title">{{ 'dashboard.pointsProgress' | translate }}</h2>
        </div>

        <!-- Progress Bar -->
        <div class="progress-container">
          <div class="progress-header">
            <span>{{ 'dashboard.nextDiscount' | translate }} (500 points)</span>
            <span class="progress-value">{{ stats.points.total }}/500</span>
          </div>
          <div class="progress-bar-wrapper">
            <div class="progress-bar" [style.width.%]="getProgressPercentage(stats.points.total, 500)"></div>
          </div>
        </div>

        <!-- Points Breakdown -->
        <div class="points-breakdown-grid">
          <div class="breakdown-card reading">
            <div class="breakdown-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
              </svg>
            </div>
            <div class="breakdown-content">
              <h5>{{ stats.points.reading }}</h5>
              <p>{{ 'dashboard.readingPoints' | translate }}</p>
            </div>
          </div>

          <div class="breakdown-card quiz">
            <div class="breakdown-icon">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
              </svg>
            </div>
            <div class="breakdown-content">
              <h5>{{ stats.points.quiz }}</h5>
              <p>{{ 'dashboard.quizPoints' | translate }}</p>
            </div>
          </div>
        </div>

        <div class="section-footer">
          <a routerLink="/references" class="btn-modern btn-primary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            <span>{{ 'dashboard.earnMorePoints' | translate }}</span>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>
