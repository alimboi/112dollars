<div class="reference-container">
  <div class="container py-5">
    <div class="loading" *ngIf="loading">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <div class="alert alert-danger" *ngIf="error">{{ error }}</div>

    <div *ngIf="!loading && !error && reference" class="reference-content">
      <button routerLink="/references" class="btn btn-outline-light mb-4">
        <i class="bi bi-arrow-left"></i> Back to References
      </button>

      <div class="reference-header">
        <h1>{{ reference.title }}</h1>
        <p class="description">{{ reference.description }}</p>
        <div class="meta">
          <span class="badge bg-primary me-2">
            <i class="bi bi-clock"></i> {{ reference.readingTimeMinutes }} min read
          </span>
          <span class="badge bg-success" *ngIf="reference.isFree">
            <i class="bi bi-unlock"></i> Free
          </span>
          <span class="badge bg-warning" *ngIf="!reference.isFree">
            <i class="bi bi-lock"></i> Premium
          </span>
        </div>
      </div>

      <div class="reference-body">
        <div class="content-block" *ngFor="let block of reference.contentBlocks" [ngSwitch]="block.blockType">
          <!-- Heading Block -->
          <h2 *ngSwitchCase="'heading'" class="heading-block" [ngStyle]="{
            'font-family': block.styling?.fontFamily,
            'font-size.px': block.styling?.fontSize,
            'color': block.styling?.color,
            'background-color': block.styling?.backgroundColor,
            'font-weight': block.styling?.fontWeight,
            'text-align': block.styling?.textAlign,
            'line-height': block.styling?.lineHeight,
            'margin-top.px': block.styling?.marginTop,
            'margin-bottom.px': block.styling?.marginBottom,
            'padding.px': block.styling?.padding
          }">{{ block.content }}</h2>

          <!-- Text Block -->
          <p *ngSwitchCase="'text'" class="text-block" [ngStyle]="{
            'font-family': block.styling?.fontFamily,
            'font-size.px': block.styling?.fontSize,
            'color': block.styling?.color,
            'background-color': block.styling?.backgroundColor,
            'font-weight': block.styling?.fontWeight,
            'text-align': block.styling?.textAlign,
            'line-height': block.styling?.lineHeight,
            'letter-spacing.px': block.styling?.letterSpacing,
            'margin-top.px': block.styling?.marginTop,
            'margin-bottom.px': block.styling?.marginBottom,
            'padding.px': block.styling?.padding
          }">{{ block.content }}</p>

          <!-- Image Block -->
          <div *ngSwitchCase="'image'" class="image-block" [ngStyle]="{'text-align': block.blockData?.alignment}">
            <img [src]="block.blockData?.url"
                 [alt]="block.blockData?.alt || 'Content image'"
                 [ngStyle]="{
                   'width': block.blockData?.width,
                   'height': block.blockData?.height,
                   'border-radius.px': block.blockData?.borderRadius
                 }"
                 [class]="'shadow-' + block.blockData?.boxShadow">
          </div>

          <!-- Video Block (YouTube Embed) -->
          <div *ngSwitchCase="'video'" class="video-block" [ngStyle]="{'text-align': block.blockData?.alignment}">
            <iframe *ngIf="block.blockData?.videoId"
                    [src]="'https://www.youtube.com/embed/' + block.blockData.videoId | safeUrl"
                    [style.width]="block.blockData?.width"
                    height="400"
                    frameborder="0"
                    allowfullscreen>
            </iframe>
          </div>

          <!-- Code Block -->
          <pre *ngSwitchCase="'code_block'" class="code-block" [ngStyle]="{
            'background-color': block.styling?.backgroundColor,
            'color': block.styling?.color,
            'padding.px': block.styling?.padding,
            'margin-top.px': block.styling?.marginTop,
            'margin-bottom.px': block.styling?.marginBottom
          }"><code>{{ block.content }}</code></pre>
        </div>
      </div>

      <div class="reference-footer">
        <button routerLink="/quiz/{{ reference.id }}" class="btn btn-primary btn-lg">
          Take Quiz <i class="bi bi-arrow-right"></i>
        </button>
      </div>
    </div>
  </div>
</div>
