<div class="blog-image-manager" [ngClass]="currentTheme">
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>Blog Rasmlari</h1>
      <button class="btn-primary" (click)="openForm()" [disabled]="saving">
        <span class="icon">+</span>
        Yangi rasm qo'shish
      </button>
    </div>

    <!-- Success Message -->
    <div class="message success-message" *ngIf="successMessage" [@fadeIn]>
      {{ successMessage }}
    </div>

    <!-- Error Message -->
    <div class="message error-message" *ngIf="error" [@fadeIn]>
      {{ error }}
    </div>

    <!-- Form Modal -->
    <div class="modal-overlay" *ngIf="isFormOpen" [@fadeIn] (click)="closeForm()">
      <div class="modal-content" [@slideUp] (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>{{ isEditMode ? 'Rasmni tahrirlash' : 'Yangi rasm qo\'shish' }}</h2>
          <button class="btn-close" (click)="closeForm()">Ã—</button>
        </div>

        <form (ngSubmit)="saveImage()" #imageForm="ngForm" class="image-form">
          <!-- Title Field -->
          <div class="form-group">
            <label for="title">Sarlavha <span class="required">*</span></label>
            <input
              type="text"
              id="title"
              name="title"
              [(ngModel)]="formData.title"
              class="form-input"
              [disabled]="saving"
              placeholder="Rasm sarlavhasini kiriting"
            />
          </div>

          <!-- Description Field -->
          <div class="form-group">
            <label for="description">Tavsif <span class="required">*</span></label>
            <textarea
              id="description"
              name="description"
              [(ngModel)]="formData.description"
              class="form-textarea"
              [disabled]="saving"
              placeholder="Rasm tavsifini kiriting"
              rows="4"
            ></textarea>
          </div>

          <!-- Image URL Field -->
          <div class="form-group">
            <label for="imageUrl">Rasm URL <span class="required">*</span></label>
            <input
              type="text"
              id="imageUrl"
              name="imageUrl"
              [(ngModel)]="formData.imageUrl"
              class="form-input"
              [disabled]="saving"
              placeholder="https://example.com/image.jpg"
            />
          </div>

          <!-- Image Preview -->
          <div class="image-preview" *ngIf="formData.imageUrl">
            <p class="preview-label">Oldindan ko'rinish</p>
            <img [src]="formData.imageUrl" alt="Oldindan ko'rinish" class="preview-image" />
          </div>

          <!-- Publish Status -->
          <div class="form-group checkbox-group">
            <label for="isPublished">
              <input
                type="checkbox"
                id="isPublished"
                name="isPublished"
                [(ngModel)]="formData.isPublished"
                [disabled]="saving"
              />
              Rasmni nashr qilish
            </label>
          </div>

          <!-- Form Actions -->
          <div class="form-actions">
            <button type="button" class="btn-secondary" (click)="closeForm()" [disabled]="saving">
              Bekor qilish
            </button>
            <button type="submit" class="btn-primary" [disabled]="saving">
              <span *ngIf="!saving">
                {{ isEditMode ? 'Yangilash' : 'Yaratish' }}
              </span>
              <span *ngIf="saving" class="spinner"></span>
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Loading State -->
    <div class="loading-container" *ngIf="loading && blogImages.length === 0">
      <div class="spinner-large"></div>
      <p>Yuklanmoqda...</p>
    </div>

    <!-- Images Table -->
    <div class="images-table" *ngIf="!loading || blogImages.length > 0">
      <div class="table-responsive">
        <table class="images-list">
          <thead>
            <tr>
              <th>Rasm</th>
              <th>Sarlavha</th>
              <th>Tavsif</th>
              <th>Holat</th>
              <th>Yaratilgan</th>
              <th>Amallar</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let image of blogImages" class="image-row" [@fadeIn]>
              <!-- Thumbnail -->
              <td class="cell-image">
                <img [src]="image.imageUrl" alt="{{ image.title }}" class="thumbnail" />
              </td>

              <!-- Title -->
              <td class="cell-title">
                <span class="title-text">{{ image.title }}</span>
              </td>

              <!-- Description -->
              <td class="cell-description">
                <span class="description-text" [title]="image.description">
                  {{ (image.description | slice: 0:50) + (image.description.length > 50 ? '...' : '') }}
                </span>
              </td>

              <!-- Status -->
              <td class="cell-status">
                <span class="status-badge" [ngClass]="image.isPublished ? 'published' : 'draft'">
                  {{ image.isPublished ? 'Nashr qilingan' : 'Qoralama' }}
                </span>
              </td>

              <!-- Created Date -->
              <td class="cell-date">
                <span class="date-text">{{ image.createdAt | date: 'short' }}</span>
              </td>

              <!-- Actions -->
              <td class="cell-actions">
                <div class="action-buttons">
                  <!-- Toggle Publish Button -->
                  <button
                    class="btn-icon btn-publish"
                    [title]="image.isPublished ? 'Nashrdan olib tashlash' : 'Nashr qilish'"
                    (click)="togglePublish(image, !image.isPublished)"
                    [disabled]="saving"
                  >
                    <span class="icon">{{ image.isPublished ? 'ğŸ‘ï¸' : 'ğŸ”’' }}</span>
                  </button>

                  <!-- Edit Button -->
                  <button
                    class="btn-icon btn-edit"
                    [title]="'Tahrirlash'"
                    (click)="openForm(image)"
                    [disabled]="saving"
                  >
                    <span class="icon">âœï¸</span>
                  </button>

                  <!-- Delete Button -->
                  <button
                    class="btn-icon btn-delete"
                    [title]="'O\'chirish'"
                    (click)="deleteImage(image.id!)"
                    [disabled]="saving"
                  >
                    <span class="icon">ğŸ—‘ï¸</span>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="blogImages.length === 0 && !loading">
        <div class="empty-icon">ğŸ“¸</div>
        <h3>Rasmlar yo'q</h3>
        <p>Boshlash uchun birinchi rasmingizni qo'shing</p>
        <button class="btn-primary" (click)="openForm()">
          Birinchi rasmni qo'shish
        </button>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination" *ngIf="totalPages > 1">
      <button
        class="pagination-btn"
        (click)="goToPage(currentPage - 1)"
        [disabled]="currentPage === 1 || loading"
      >
        â† Oldingi
      </button>

      <div class="page-info">
        Sahifa: <strong>{{ currentPage }}</strong> / <strong>{{ totalPages }}</strong>
      </div>

      <button
        class="pagination-btn"
        (click)="goToPage(currentPage + 1)"
        [disabled]="currentPage === totalPages || loading"
      >
        Keyingi â†’
      </button>
    </div>
  </div>
</div>
