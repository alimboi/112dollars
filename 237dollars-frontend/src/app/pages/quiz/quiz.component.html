<div class="quiz-container">
  <div class="container py-5">
    <div class="loading" *ngIf="loading">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <div class="alert alert-danger" *ngIf="error">{{ error }}</div>

    <div *ngIf="!loading && !error && quiz && !submitted" class="quiz-content">
      <div class="quiz-header">
        <h1>{{ quiz.title }}</h1>
        <p>{{ quiz.description }}</p>
        <div class="progress mb-3">
          <div class="progress-bar" [style.width.%]="progress"></div>
        </div>
        <p class="text-secondary">Question {{ currentQuestionIndex + 1 }} of {{ quiz.totalQuestions }}</p>
      </div>

      <div class="question-card" *ngIf="currentQuestion">
        <h3 class="question-text">{{ currentQuestion.questionText }}</h3>

        <div class="options">
          <div class="option"
               *ngFor="let option of [
                 {value: 1, text: currentQuestion.option1},
                 {value: 2, text: currentQuestion.option2},
                 {value: 3, text: currentQuestion.option3},
                 {value: 4, text: currentQuestion.option4}
               ]"
               [class.selected]="answers[currentQuestion.id] === option.value"
               (click)="selectAnswer(option.value)">
            <div class="option-radio"></div>
            <span>{{ option.text }}</span>
          </div>
        </div>
      </div>

      <div class="quiz-navigation">
        <button class="btn btn-outline-light"
                (click)="previousQuestion()"
                [disabled]="currentQuestionIndex === 0">
          <i class="bi bi-arrow-left"></i> Previous
        </button>

        <button class="btn btn-primary"
                *ngIf="currentQuestionIndex < quiz.totalQuestions - 1"
                (click)="nextQuestion()"
                [disabled]="!answers[currentQuestion?.id!]">
          Next <i class="bi bi-arrow-right"></i>
        </button>

        <button class="btn btn-success"
                *ngIf="currentQuestionIndex === quiz.totalQuestions - 1"
                (click)="submitQuiz()"
                [disabled]="Object.keys(answers).length !== quiz.totalQuestions">
          Submit Quiz
        </button>
      </div>
    </div>

    <div *ngIf="submitted && result" class="quiz-result">
      <div class="result-card" [class.passed]="result.isPassed" [class.failed]="!result.isPassed">
        <div class="result-icon">
          <i [class]="result.isPassed ? 'bi bi-check-circle' : 'bi bi-x-circle'"></i>
        </div>
        <h2>{{ result.isPassed ? 'Congratulations!' : 'Try Again' }}</h2>
        <p class="score">{{ result.scorePercentage }}%</p>
        <p class="message">
          {{ result.isPassed ? 'You passed the quiz!' : 'You need ' + quiz?.passScorePercentage + '% to pass' }}
        </p>
        <p class="time">Time taken: {{ Math.floor(result.timeTakenSeconds / 60) }}m {{ result.timeTakenSeconds % 60 }}s</p>

        <div class="result-actions">
          <button class="btn btn-primary" routerLink="/references">Back to References</button>
          <button class="btn btn-outline-light" (click)="retakeQuiz()" *ngIf="!result.isPassed">Retake Quiz</button>
        </div>
      </div>
    </div>
  </div>
</div>
