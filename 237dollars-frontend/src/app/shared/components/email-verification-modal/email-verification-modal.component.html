<div class="modal-overlay" (click)="closeModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <button class="close-button" (click)="closeModal()" aria-label="Close">
      <span>&times;</span>
    </button>

    <div class="modal-header">
      <h2>Elektron pochtangizni tasdiqlang</h2>
      <p class="email-display">{{ email }}</p>
    </div>

    <div class="modal-body">
      <p class="instruction">
        Elektron pochtangizga 6 xonali tasdiqlash kodini yubordik. Iltimos, uni quyida kiriting.
      </p>

      <div class="timer" *ngIf="timeRemaining > 0">
        <span class="timer-icon">⏱️</span>
        <span class="timer-text">Kod amal qilish muddati: <strong>{{ getFormattedTime() }}</strong></span>
      </div>

      <div class="timer expired" *ngIf="timeRemaining <= 0">
        <span class="timer-icon">⚠️</span>
        <span class="timer-text">Kod muddati tugagan</span>
      </div>

      <form [formGroup]="verificationForm" (ngSubmit)="verifyCode()">
        <div class="form-group">
          <label for="code">Tasdiqlash kodi</label>
          <input
            id="code"
            type="text"
            formControlName="code"
            class="code-input"
            placeholder="000000"
            maxlength="6"
            [class.error]="verificationForm.get('code')?.invalid && verificationForm.get('code')?.touched"
          />
          <div class="error-message" *ngIf="verificationForm.get('code')?.invalid && verificationForm.get('code')?.touched">
            <span *ngIf="verificationForm.get('code')?.errors?.['required']">Tasdiqlash kodi talab qilinadi</span>
            <span *ngIf="verificationForm.get('code')?.errors?.['pattern']">Kod 6 ta raqamdan iborat bo'lishi kerak</span>
          </div>
        </div>

        <div class="alert alert-error" *ngIf="error">
          {{ error }}
        </div>

        <div class="alert alert-success" *ngIf="success">
          {{ success }}
        </div>

        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="loading || verificationForm.invalid"
        >
          <span *ngIf="!loading">Tasdiqlash</span>
          <span *ngIf="loading">Tasdiqlanmoqda...</span>
        </button>
      </form>

      <div class="resend-section">
        <p class="resend-text">Kod kelmadimi?</p>
        <button
          class="btn btn-secondary"
          (click)="resendCode()"
          [disabled]="!canResend || loading"
        >
          <span *ngIf="canResend">Kodni qayta yuborish</span>
          <span *ngIf="!canResend">Qayta yuborish {{ getResendCountdown() }}</span>
        </button>
      </div>
    </div>
  </div>
</div>
